sudo: required
dist: xenial
language: cpp
compiler:
    - clang
    - gcc
os:
    - linux
cache: ccache
git:
    depth: 3
services:
    - xvfb
before_install:
    - sudo apt-get update -qq
# trusty
#    - sudo apt-get install -qq bsdtar python-dev libpcre3-dev libssl-dev zlib1g-dev libc6-dev libpng12-dev libjpeg-dev libtiff5-dev libmng-dev libcups2-dev libfreetype6-dev libfontconfig1-dev libicu-dev libglib2.0-dev libdbus-1-dev unixodbc-dev libpq-dev libpqtypes-dev libmysqld-dev libaio-dev libwrap0-dev libsqlite3-dev xorg-dev
# xenial
    - sudo apt-get install -qq bsdtar python-dev libpcre3-dev libssl-dev zlib1g-dev libc6-dev libpng-dev libjpeg-dev libtiff-dev libmng-dev libcups2-dev libfreetype6-dev libfontconfig1-dev libicu-dev libglib2.0-dev libdbus-1-dev unixodbc-dev libpq-dev libpqtypes-dev libmysqld-dev libaio-dev libwrap0-dev liblz4-dev libsqlite3-dev xorg-dev
# both trusty and xenial offer old ninja-build which cannot resolve conflicts in generated files
    - wget https://github.com/ninja-build/ninja/releases/download/v1.8.2/ninja-linux.zip
    - bsdtar xf ninja-linux.zip
before_script:
# use downloaded ninja
    - export PATH="$(pwd):${PATH}"
# for GUI access on trusty, e.g. QApplication requires it
#    - export DISPLAY=:99.0
#    - sh -e /etc/init.d/xvfb start
#    - sleep 3
script:
    - mkdir build && cd build
    - if [ "$CXX" == "clang++" ];then cmake ../ -GNinja -DCMAKE_BUILD_TYPE=Release -DENABLE_TESTING=TRUE -DKATIE_UTILS=ON -Wno-dev ;fi
    - if [ "$CXX" == "g++" ];then cmake ../ -GNinja -DCMAKE_BUILD_TYPE=Release -DENABLE_TESTING=TRUE -DKATIE_UTILS=ON -DKATIE_ALLINONE=ON -Wno-dev ;fi
    - ninja
# the tests/benchmarks take more then 1-hour and Travis times out,
# despite the documentaiton for the service claiming the timeout is longer
